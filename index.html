<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Cornell DTI: Relay For Life 2018</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
			#header {
				height:100px;
				position:fixed;
				top:0;
				background:#00000000;
				width:100%;
			}
		</style>
	</head>
	<body>
		<div id="header">
			<img src="http://cornelldti.org/img/logos/cornelldti.png" height="90px" align="left">
			<img src="https://www.relayforlife.org.au/globalassets/learn-images/logomainimage.jpg" height="90px" align="right">
		</div>
		<script src="three.js"></script>
		<script src="OrbitControls.js"></script>
		<script src='threex.domevents.js'></script>
		<script>
			var scene = new THREE.Scene();
			var width = window.innerWidth;
			var ratio = window.innerHeight / width;
			var camera = new THREE.OrthographicCamera( -10, 10, 10*ratio, -10*ratio, -10, 1000);

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			var controls = new THREE.OrbitControls(camera, renderer.domElement);
			controls.enableZoom = false;
			controls.target = new THREE.Vector3(0,0,0);
			controls.autoRotate = true;

			// Point Light Sources
			var lights = [];
			lights[ 0 ] = new THREE.PointLight( 0xffffff, 0.5, 0 )
			lights[ 1 ] = new THREE.PointLight( 0xffffff, 0.5, 0 )
			lights[ 2 ] = new THREE.PointLight( 0xffffff, 0.5, 0 )
			lights[ 3 ] = new THREE.PointLight( 0xffffff, 0.5, 0 )
			lights[ 4 ] = new THREE.PointLight( 0xffffff, 0.5, 0 )
			lights[ 5 ] = new THREE.PointLight( 0xffffff, 0.5, 0 )
			lights[ 6 ] = new THREE.PointLight( 0xffffff, 0.5, 0 )
			lights[ 7 ] = new THREE.PointLight( 0xffffff, 0.5, 0 )
			lights[ 0 ].position.set(10, 10, 10)
			lights[ 1 ].position.set(10, 10, -10)
			lights[ 2 ].position.set(10, -10, 10)
			lights[ 3 ].position.set(10, -10, -10)
			lights[ 4 ].position.set(-10, 10, 10)
			lights[ 5 ].position.set(-10, 10, -10)
			lights[ 6 ].position.set(-10, -10, 10)
			lights[ 7 ].position.set(-10, -10, -10)
			scene.add( lights[ 0 ] )
			scene.add( lights[ 1 ] )
			scene.add( lights[ 2 ] )
			scene.add( lights[ 3 ] )
			scene.add( lights[ 4 ] )
			scene.add( lights[ 5 ] )
			scene.add( lights[ 6 ] )
			scene.add( lights[ 7 ] )
			
			var domEvents	= new THREEx.DomEvents(camera, renderer.domElement)

			var spheres = [];

			var numSpheres = 100;
			for (var i = 0; i < numSpheres; i++) {
				addUniqueSphere({"message": i});
			}
			for (var i = 0; i < spheres.length; i++) {
				scene.add(spheres[i]);
			}

			camera.position.z = 5;
			camera.position.y = 2;
			controls.update();

			var contraction = -1;

			function animate() {
				requestAnimationFrame( animate );
				controls.update();
				for (var i = 0; i < spheres.length; i++) {
					spheres[i].rotation.y += 0.01
					spheres[i].scale.x += 0.0034 * contraction;
					spheres[i].scale.y += 0.0034 * contraction;
					spheres[i].scale.z += 0.0034 * contraction;
					
				}
				if (spheres[0].scale.x >= 1.0) {
					contraction = -1;
				}
				if (spheres[0].scale.x <= 0.9) {
					contraction = 1;
				}

				renderer.render( scene, camera );
			}
			animate();

			function addUniqueSphere(data) {
				var x = Math.round(Math.random()*10 - 5);
				var y = Math.round(ratio*(Math.random()*10 - 5));
				var z = Math.round(Math.random()*10 - 5);
				for (var j = 0; j < spheres.length; j++) {
					if (spheres[j].x == x && spheres[j].y == y && spheres[j].z == z) {
						break;
					}
				}
				if (j < spheres.length) {
					return createUniqueSphere();
				} else {
					spheres.push(createSphere(x, y, z, 0.5, data));
					scene.add(spheres[spheres.length-1])
				}
			}

			function createSphere(x, y, z, radius, data) {
				var geometry = new THREE.SphereGeometry( radius, 8, 8, 0, 6.3, 0, 3.1 );
				var material = new THREE.MeshPhongMaterial( { 
					color: 0x702BB0,
					side: THREE.DoubleSide,
					flatShading: true
				} );
				var sphere = new THREE.Mesh( geometry, material );
				sphere.add(new THREE.LineSegments(new THREE.Geometry(),
					new THREE.LineBasicMaterial({
						color:0xffffff,
						transparent:true,
						opacity:0.5
					})
				))
				sphere.data = data;
				domEvents.addEventListener(sphere, 'click', function(event){
					console.log('you clicked on the mesh. ' + JSON.stringify(sphere.data))
				}, false)
				sphere.position.x = x;
				sphere.position.y = y;
				sphere.position.z = z;
				return sphere;
			}
		</script>
	</body>
</html>